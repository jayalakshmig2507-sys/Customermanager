<!DOCTYPE html>
<html>
<head>
  <title>Customer Enquiry Inbox</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAqDsqgTeRD3sAXncZVPFkKinOVYZ2VXo4",
      authDomain: "customer-enquiry-manager.firebaseapp.com",
      projectId: "customer-enquiry-manager",
      storageBucket: "customer-enquiry-manager.firebasestorage.app",
      messagingSenderId: "917955055710",
      appId: "1:917955055710:web:5fb547b9462eda55fde4cf",
      measurementId: "G-890LYDT9CW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadEnquiries() {
      const enquiriesContainer = document.getElementById("enquiries");
      enquiriesContainer.innerHTML = "Loading...";
      
      const q = query(collection(db, "enquiries"), orderBy("createdAt", "desc"));
      const querySnapshot = await getDocs(q);
      
      if (querySnapshot.empty) {
        enquiriesContainer.innerHTML = "<p>No enquiries found.</p>";
        return;
      }

      enquiriesContainer.innerHTML = "";
      querySnapshot.forEach(docSnap => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.padding = "10px";
        div.style.marginBottom = "10px";

        div.innerHTML = `
          <p><strong>Name:</strong> ${data.name}</p>
          <p><strong>Email:</strong> ${data.email}</p>
          <p><strong>Department:</strong> ${data.department}</p>
          <p><strong>Message:</strong> ${data.message}</p>
          <p><strong>Status:</strong> <span id="status-${docSnap.id}">${data.status}</span></p>
          <button onclick="updateStatus('${docSnap.id}', 'Contacted')">Mark Contacted</button>
          <button onclick="updateStatus('${docSnap.id}', 'Closed')">Mark Closed</button>
        `;
        enquiriesContainer.appendChild(div);
      });
    }

    window.updateStatus = async function(id, newStatus) {
      try {
        const docRef = doc(db, "enquiries", id);
        await updateDoc(docRef, { status: newStatus });
        document.getElementById(`status-${id}`).innerText = newStatus;
        alert("Status updated!");
      } catch (error) {
        console.error("Error updating status:", error);
        alert("Failed to update status.");
      }
    }

    window.onload = loadEnquiries;
  </script>
</head>
<body>
  <h2>Customer Enquiry Inbox</h2>
  <div id="enquiries" style="max-width:600px;margin:auto;"></div>
</body>
</html>
